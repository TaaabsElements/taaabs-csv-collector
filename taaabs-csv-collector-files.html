<link rel="import" href="../taaabs-themes/taaabs-dark-theme.html">
<link rel="import" href="../file-reader/file-reader.html">
<dom-module id="taaabs-csv-collector-files">
  <template>

    <style include="taaabs-dark-theme"></style>
    <style>
      :host {
        width: 100%;
        display: block
      }

      :host .editIcons {
        float: right;
        cursor: pointer;
      }

      :host #submit {
        opacity: 0.27;
      }
    </style>

    <iron-icon icon="icons:close" class="editIcons fgRed fgRedH" id="cancel" on-click="_cancel">
    </iron-icon>
    <iron-icon icon="icons:forward" class="editIcons fgGreen fgGreenH" id="submit" on-click="_submit">
    </iron-icon>
    <h4> <span>[[localize('fSHeader')]]</span> </h4>
    <file-reader id="filereaderElem" files={{files}}></file-reader>
    <div style="line-height: normal; letter-spacing: normal; font-size:16px; margin-top: 30px; ">
      <table>
        <tr>
          <th><span>[[localize('fSFileName')]]</span></th>
          <th><span>[[localize('fSFileSize')]]</span></th>
        </tr>
        <template is="dom-repeat" items="{{files}}">
          <tr>
            <td> <span>{{item.name}}</span> </td>
            <td> <span>{{item.size}}</span> </td>
          </tr>
        </template>
      </table>
    </div>

  </template>

  <script>
    /* global Polymer */

    Polymer({

      is: 'taaabs-csv-collector-files',

      /**
       * Fired when the submit button is clicked and at least one file has been selected.
       *
       * @event FILES_SELECTED
       */

      properties: {

        /**
         * The files selected.
         *
         * @attribute files
         * @type Array
         */
        files: {
          type: Array,
          notify: true,
          value: []
        },

        /**
         * The `file-reader` component.
         *
         * @attribute fileReader
         * @type Object
         */
        fileReader: {
          type: Object,
          notify: true,
          value: null
        },

        ////////////////
        // _i18n VARS //
        ////////////////

        resources: {
          value: function() {
            return {
              "en": {
                "fSHeader": "Select the trace files you want to import",
                "fSFileName": "Files name",
                "fSFileSize": "Size (bytes)"
              },
              "fr": {
                "fSHeader": "SÃ©lectionnez les fichiers de traces que vous souhaitez importer",
                "fSFileName": "Nom des fichiers",
                "fSFileSize": "Taille (octets)"
              }
            }
          }
        },

        /**
         * Localization.
         * fr, en.
         *
         * @attribute language
         * @type String
         */
        language: {
          type: String,
          notify: true,
          value: 'en'
        }
      },

      behaviors: [
        Polymer.AppLocalizeBehavior
      ],

      ready: function() {
        // Set the `_filereader`.
        this.set('fileReader', this.$.filereaderElem);

        // Create a pointer to `this` for later.
        var that = this;

        // Function triggered when the user has chosen some files with the
        //`_filereader`.
        this.fileReader.returnFunction = function() {
          // Changes css of the next step button
          that.$.submit.style.cursor = "pointer";
          that.$.submit.style.opacity = 1;
        }
      },

      _cancel: function() {
        this.set('files', []);
      },

      _submit: function() {
        if (this.files.length > 0)
          this.fire('FILES_SELECTED');
      }
    });
  </script>

</dom-module>
